# FILE: .github/workflows/jsa_v2.yml
# Runs job_search_agent v2 daily at 12:00 Europe/Oslo (10:00 UTC)
name: job_search_agent v2 (daily)


on:
schedule:
- cron: '0 10 * * *' # 10:00 UTC = 12:00 Europe/Oslo (Sep DST)
workflow_dispatch:


jobs:
run-v2:
runs-on: ubuntu-latest
permissions:
contents: write
steps:
- uses: actions/checkout@v4
- uses: actions/setup-python@v5
with:
python-version: '3.11'
- name: Install deps
run: |
python -m pip install --upgrade pip
pip install requests beautifulsoup4
- name: Abort if outside 15-day experiment window
run: |
start="2025-09-09" # start tomorrow (Europe/Oslo)
today_utc=$(date -u +%F)
# Compute day offset from start (UTC dates are fine at 10:00 UTC)
days=$(( ( $(date -ud "$today_utc" +%s) - $(date -ud "$start" +%s) )/86400 ))
if [ $days -lt 0 ] || [ $days -ge 15 ]; then
echo "Outside experiment window; skipping."; exit 0; fi
- name: Patch quiet hour (safety)
run: |
sed -i 's/QUIET_AFTER_HOUR = [0-9]*/QUIET_AFTER_HOUR = 23/' job_search_agent_v2.py || true
- name: Run v2
run: |
python job_search_agent_v2.py --location "Oslo" --days 7 --top 10
- name: Stamp filenames with _v2
run: |
d=$(date -u +%F)
mkdir -p logs
if [ -f logs/${d}.json ]; then cp logs/${d}.json logs/${d}_v2.json; fi
if [ -f logs/${d}.csv ]; then cp logs/${d}.csv logs/${d}_v2.csv; fi
- name: Commit logs
run: |
git config user.name "jsa-bot"
git config user.email "jsa-bot@users.noreply.github.com"
git add logs/
git commit -m "v2 run $(date -u +%F)" || echo "Nothing to commit"
git push
